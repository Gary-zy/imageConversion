# OFD 预览组件 - 问题检查清单

在使用组件之前，请务必检查以下项目：

## ✅ 依赖检查

### 必需的 npm 包（必须全部安装）

```bash
npm install \
  jszip \
  jszip-utils \
  jspdf \
  file-saver \
  html2canvas \
  ofd-xml-parser \
  js-md5 \
  js-sha1 \
  @lapo/asn1js \
  jsrsasign \
  jsrsasign-util \
  sm-crypto \
  web-streams-polyfill
```

**快速检查命令**：
```bash
# 检查是否安装了所有必需依赖
npm list jszip jszip-utils jspdf file-saver html2canvas ofd-xml-parser js-md5 js-sha1 @lapo/asn1js jsrsasign jsrsasign-util sm-crypto web-streams-polyfill
```

### 最常见的错误

1. **缺少 `ofd-xml-parser`**
   - 错误信息：`Cannot find module 'ofd-xml-parser'`
   - 解决：`npm install ofd-xml-parser`

2. **缺少 `jszip-utils`**
   - 错误信息：`Cannot find module 'jszip-utils'`
   - 解决：`npm install jszip-utils`

3. **缺少签名验证相关依赖**
   - 错误信息：`Cannot find module 'jsrsasign'`
   - 解决：`npm install jsrsasign jsrsasign-util @lapo/asn1js`

## ✅ 文件结构检查

确保以下文件存在：

```
ofd-preview-component/
├── src/
│   ├── components/
│   │   ├── OfdPreview.tsx     ✅ 必需
│   │   └── OfdProcessor.tsx   ✅ 必需
│   ├── core/
│   │   ├── ofd.js             ✅ 必需
│   │   ├── ofd_parser.js      ✅ 必需
│   │   ├── ofd_render.js      ✅ 必需
│   │   ├── ofd_util.js        ✅ 必需
│   │   ├── pipeline.js        ✅ 必需
│   │   ├── sm3.js             ✅ 必需
│   │   ├── ses_signature_parser.js  ✅ 必需
│   │   ├── verify_signature_util.js ✅ 必需
│   │   └── jbig2/             ✅ 必需（整个目录）
│   ├── utils/
│   │   └── OfdConverter.ts    ✅ 必需
│   ├── types/
│   │   └── index.ts           ✅ 必需
│   └── index.ts               ✅ 必需
```

**检查命令**：
```bash
# 检查核心文件是否存在
ls -la src/core/ofd.js
ls -la src/core/ofd_parser.js
ls -la src/core/ofd_render.js
ls -la src/components/OfdProcessor.tsx
ls -la src/utils/OfdConverter.ts
```

## ✅ 导入路径检查

如果你的项目结构不同，可能需要调整导入路径：

### 常见路径问题

**问题 1**: 组件放在 `src/components/` 下
```tsx
// ✅ 正确
import { OfdProcessor } from './components/ofd-preview-component';

// ❌ 错误
import { OfdProcessor } from './ofd-preview-component';
```

**问题 2**: 组件放在 `src/lib/` 下
```tsx
// ✅ 正确
import { OfdProcessor } from './lib/ofd-preview-component';

// ❌ 错误
import { OfdProcessor } from 'ofd-preview-component';
```

**问题 3**: 作为 npm 包安装
```tsx
// ✅ 正确
import { OfdProcessor } from 'ofd-preview-component';

// ❌ 错误
import { OfdProcessor } from './ofd-preview-component';
```

## ✅ 浏览器兼容性检查

组件需要以下浏览器特性：

- ✅ ES6+ 支持
- ✅ Canvas API
- ✅ File API
- ✅ Promise
- ✅ async/await

**最低浏览器版本**：
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## ✅ 开发环境检查

### TypeScript 项目

确保 `tsconfig.json` 包含：
```json
{
  "compilerOptions": {
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "moduleResolution": "node",
    "jsx": "react-jsx"
  }
}
```

### Vite 项目

确保 `vite.config.js` 正确配置：
```javascript
export default {
  // ... 其他配置
}
```

### Next.js 项目

确保组件在客户端使用：
```tsx
'use client';  // Next.js 13+
import { OfdProcessor } from './lib/ofd-preview-component';
```

## ✅ 样式检查

组件使用 Tailwind CSS，需要：

**选项 1**: 项目已配置 Tailwind CSS
```javascript
// tailwind.config.js
module.exports = {
  content: [
    "./src/**/*.{js,jsx,ts,tsx}",
    "./src/components/ofd-preview-component/**/*.{js,jsx,ts,tsx}",
  ],
}
```

**选项 2**: 不使用 Tailwind
- 组件样式会失效，但功能正常
- 需要自己提供 CSS 样式

## ✅ 常见错误排查

### 错误 1: `Cannot find module 'ofd-xml-parser'`

**原因**: 缺少核心依赖

**解决**:
```bash
npm install ofd-xml-parser
```

### 错误 2: `parseOfdDocument is not a function`

**原因**: ofd.js 文件未正确加载或导入路径错误

**解决**:
1. 检查 `src/core/ofd.js` 是否存在
2. 检查 `OfdConverter.ts` 中的导入路径是否正确

### 错误 3: `renderOfd is not a function`

**原因**: 同上，ofd.js 未正确加载

**解决**: 同上

### 错误 4: 组件渲染但样式不生效

**原因**: 没有配置 Tailwind CSS

**解决**:
- 配置 Tailwind CSS，或
- 通过 `className` 和 `style` 属性提供自定义样式

### 错误 5: OFD 文件无法加载

**可能原因**:
1. 缺少 `jszip-utils` 依赖
2. 文件格式不正确
3. 文件过大（>50MB）

**解决**:
```bash
npm install jszip-utils
```

## ✅ 功能测试清单

安装完成后，请测试以下功能：

- [ ] 上传 OFD 文件
- [ ] 查看文档预览
- [ ] 切换页面（上一页/下一页）
- [ ] 调整缩放（50% - 300%）
- [ ] 转换为 PNG
- [ ] 转换为 JPEG
- [ ] 转换为 WebP
- [ ] 转换为 PDF
- [ ] 自定义页面范围转换
- [ ] 下载转换后的文件

## ✅ 性能检查

- [ ] 小文件（<1MB）加载时间 < 3 秒
- [ ] 中等文件（1-10MB）加载时间 < 10 秒
- [ ] 大文件（10-50MB）加载时间 < 30 秒
- [ ] 内存占用 < 500MB（单文件）
- [ ] 页面切换响应时间 < 500ms

## ✅ 如果遇到问题

1. **检查依赖**: 运行 `npm list` 查看所有依赖是否安装
2. **检查文件**: 确保所有核心文件存在
3. **检查路径**: 确保导入路径正确
4. **检查控制台**: 查看浏览器控制台的错误信息
5. **查看文档**: 参考 README.md 获取详细说明

## ✅ 完整验证命令

```bash
# 1. 检查文件结构
find src/core/ofd.js src/utils/OfdConverter.ts src/components/OfdProcessor.tsx

# 2. 检查依赖
npm list jszip jszip-utils ofd-xml-parser jspdf file-saver html2canvas

# 3. 检查其他依赖
npm list js-md5 js-sha1 @lapo/asn1js jsrsasign jsrsasign-util sm-crypto web-streams-polyfill
```

全部通过？组件应该可以正常使用了！🎉
